# ðŸ—„ï¸ Database Schema - Nexus Plugin

## Vue d'Ensemble

[cite_start]Le plugin Nexus utilise MariaDB comme systÃ¨me de base de donnÃ©es principal avec HikariCP pour le pooling de connexions et Flyway pour la gestion des migrations. [cite: 721] [cite_start]Cette documentation dÃ©crit le schÃ©ma complet de la base de donnÃ©es. [cite: 722]

## ðŸ“Š Diagramme ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     arenas      â”‚    â”‚  arena_spawns   â”‚    â”‚    matches      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”€â”¬â”‚ arena_id (FK)   â”‚    â”‚ id (PK)         â”‚
â”‚ name (UNIQUE)   â”‚   â””â”‚ team_id         â”‚    â”‚ arena_name      â”‚
â”‚ game_mode       â”‚    â”‚ spawn_number    â”‚    â”‚ game_mode       â”‚
â”‚ max_players     â”‚    â”‚ world           â”‚    â”‚ match_status    â”‚
â”‚ min_players     â”‚    â”‚ x, y, z         â”‚    â”‚ total_players   â”‚
â”‚ world_name      â”‚    â”‚ yaw, pitch      â”‚    â”‚ duration_secs   â”‚
â”‚ region_data     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ winner_team_id  â”‚
â”‚ config_data     â”‚                           â”‚ match_data      â”‚
â”‚ created_at      â”‚                           â”‚ started_at      â”‚
â”‚ updated_at      â”‚                           â”‚ ended_at        â”‚
â”‚ is_active       â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ player_profiles â”‚    â”‚match_participantsâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ player_uuid(PK) â”‚â”€â”€â”€â”¬â”‚ player_uuid(FK) â”‚
â”‚ player_name     â”‚   â””â”‚ match_id (FK)   â”‚
â”‚ display_name    â”‚    â”‚ team_id         â”‚
â”‚ elo_rating      â”‚    â”‚ kills           â”‚
â”‚ current_rank    â”‚    â”‚ deaths          â”‚
â”‚ total_points    â”‚    â”‚ assists         â”‚
â”‚ settings_data   â”‚    â”‚ damage_dealt    â”‚
â”‚ created_at      â”‚    â”‚ points_earned   â”‚
â”‚ updated_at      â”‚    â”‚ elo_change      â”‚
â”‚ last_seen       â”‚    â”‚ left_early      â”‚
â”‚ is_active       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚player_statisticsâ”‚    â”‚economy_transactions
         â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â””â”€â”€â”€â†’â”‚ player_uuid(FK) â”‚    â”‚ player_uuid(FK) â”‚
              â”‚ game_mode       â”‚    â”‚ transaction_typeâ”‚
              â”‚ total_matches   â”‚    â”‚ amount          â”‚
              â”‚ wins/losses     â”‚    â”‚ balance_before  â”‚
              â”‚ kills/deaths    â”‚    â”‚ balance_after   â”‚
              â”‚ damage_stats    â”‚    â”‚ reason          â”‚
              â”‚ objective_stats â”‚    â”‚ created_at      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    seasons      â”‚    â”‚ season_rewards  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”€â”¬â”‚ season_id (FK)  â”‚
â”‚ season_name     â”‚   â””â”‚ player_uuid(FK) â”‚
â”‚ season_number   â”‚    â”‚ final_rank      â”‚
â”‚ start_date      â”‚    â”‚ final_elo       â”‚
â”‚ end_date        â”‚    â”‚ matches_played  â”‚
â”‚ is_active       â”‚    â”‚ rewards_claimed â”‚
â”‚ rewards_data    â”‚    â”‚ rewards_data    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“‹ Tables DÃ©taillÃ©es

### Table `arenas`
[cite_start]Stocke toutes les informations des arÃ¨nes de jeu. [cite: 734]
```sql
CREATE TABLE arenas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    game_mode ENUM(
        'SOLO_1V1', 
        'SOLO_1V1V1', 
        'SOLO_1V1V1V1',
        'TEAM_2V2', 
        'TEAM_3V3',
        'TEAM_4V4', 
        'BATTLE_6V6V6V6'
    ) NOT NULL,
    max_players INT NOT NULL,
    min_players INT NOT NULL,
    world_name VARCHAR(255) NOT NULL,
    region_data JSON COMMENT 'DonnÃ©es de rÃ©gion WorldGuard (optionnel)',
    config_data JSON COMMENT 'Configuration spÃ©cifique Ã  l''arÃ¨ne',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    
    INDEX idx_game_mode (game_mode),
    INDEX idx_active (is_active),
    INDEX idx_world (world_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Champs JSON** :
- `region_data` : `{"min_x": -50, "min_y": 0, "min_z": -50, "max_x": 50, "max_y": 100, "max_z": 50}`
- `config_data` : `{"match_timeout": 1200, "respawn_delay": 5, "custom_rules": {...}}`

### Table `arena_spawns`
Points de spawn par Ã©quipe pour chaque arÃ¨ne.
```sql
CREATE TABLE arena_spawns (
    id INT AUTO_INCREMENT PRIMARY KEY,
    arena_id INT NOT NULL,
    team_id INT NOT NULL COMMENT 'ID de l''Ã©quipe (1, 2, 3, 4)',
    spawn_number INT NOT NULL COMMENT 'NumÃ©ro du spawn dans l''Ã©quipe',
    world VARCHAR(255) NOT NULL,
    x DOUBLE NOT NULL,
    y DOUBLE NOT NULL,
    z DOUBLE NOT NULL,
    yaw FLOAT NOT NULL,
    pitch FLOAT NOT NULL,
    
    CONSTRAINT fk_arena_spawns_arena
        FOREIGN KEY (arena_id) REFERENCES arenas(id) 
        ON DELETE CASCADE,
    
    UNIQUE KEY unique_spawn (arena_id, team_id, spawn_number),
    INDEX idx_arena_team (arena_id, team_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### Table `player_profiles`
[cite_start]Profils des joueurs avec informations de base. [cite: 740]

```sql
CREATE TABLE player_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    player_uuid CHAR(36) NOT NULL UNIQUE,
    player_name VARCHAR(16) NOT NULL,
    display_name VARCHAR(32),
    elo_rating INT DEFAULT 1000,
    current_rank ENUM(
        'UNRANKED', 'BRONZE_I', 'BRONZE_II', 'BRONZE_III',
        'SILVER_I', 'SILVER_II', 'SILVER_III',
        'GOLD_I', 'GOLD_II', 'GOLD_III',
        'PLATINUM_I', 'PLATINUM_II', 'PLATINUM_III',
        'DIAMOND_I', 'DIAMOND_II', 'DIAMOND_III',
        'MASTER', 'GRANDMASTER', 'CHAMPION'
    ) DEFAULT 'UNRANKED',
    total_points INT DEFAULT 0,
    settings_data JSON COMMENT 'PrÃ©fÃ©rences utilisateur',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    
    INDEX idx_elo_rating (elo_rating DESC),
    INDEX idx_rank (current_rank),
    INDEX idx_points (total_points DESC),
    INDEX idx_last_seen (last_seen DESC),
    INDEX idx_name (player_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Structure `settings_data`** :
```json
{
    "auto_respawn": true,
    "team_chat_enabled": true,
    "death_messages": true,
    "statistics_tracking": true,
    "preferred_kit": "balanced",
    "ui_scale": "normal",
    "sound_enabled": true,
    "particle_effects": true
}
```

### Table `player_statistics`
[cite_start]Statistiques dÃ©taillÃ©es par mode de jeu. [cite: 744]
```sql
CREATE TABLE player_statistics (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    player_uuid CHAR(36) NOT NULL,
    game_mode ENUM(
        'SOLO_1V1', 'SOLO_1V1V1', 'SOLO_1V1V1V1',
        'TEAM_2V2', 'TEAM_3V3', 'TEAM_4V4', 'BATTLE_6V6V6V6'
    ) NOT NULL,
    
    -- Statistiques de match
    total_matches INT DEFAULT 0,
    wins INT DEFAULT 0,
    losses INT DEFAULT 0,
    draws INT DEFAULT 0,
    
    -- Statistiques de combat
    kills INT DEFAULT 0,
    deaths INT DEFAULT 0,
    assists INT DEFAULT 0,
    damage_dealt DOUBLE DEFAULT 0.0,
    damage_received DOUBLE DEFAULT 0.0,
    best_killstreak INT DEFAULT 0,
    
    -- Statistiques d'objectif
    cells_captured INT DEFAULT 0,
    cells_delivered INT DEFAULT 0,
    nexus_destroyed INT DEFAULT 0,
    nexus_defended INT DEFAULT 0,
    
    -- Statistiques de temps
    total_playtime_seconds BIGINT DEFAULT 0,
    average_match_duration_seconds INT DEFAULT 0,
    
    -- Statistiques Ã©conomiques
    total_points_earned INT DEFAULT 0,
    total_points_spent INT DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_player_stats_profile 
        FOREIGN KEY (player_uuid) REFERENCES player_profiles(player_uuid) 
        ON DELETE CASCADE,
    
    UNIQUE KEY unique_player_mode (player_uuid, game_mode),
    INDEX idx_wins (wins DESC),
    INDEX idx_kdr ((kills / GREATEST(deaths, 1)) DESC),
    INDEX idx_winrate ((wins / GREATEST(total_matches, 1)) DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### Table `matches`
[cite_start]Historique des matches jouÃ©s. [cite: 748]

```sql
CREATE TABLE matches (
    id VARCHAR(36) PRIMARY KEY COMMENT 'UUID du match',
    arena_name VARCHAR(255) NOT NULL,
    game_mode ENUM(
        'SOLO_1V1', 'SOLO_1V1V1', 'SOLO_1V1V1V1',
        'TEAM_2V2', 'TEAM_3V3', 'TEAM_4V4', 'BATTLE_6V6V6V6'
    ) NOT NULL,
    match_status ENUM(
        'WAITING', 'STARTING', 'IN_PROGRESS', 'PAUSED', 
        'FINISHED', 'CANCELLED', 'ABANDONED'
    ) NOT NULL DEFAULT 'WAITING',
    total_players INT NOT NULL,
    duration_seconds INT DEFAULT 0,
    winner_team_id INT COMMENT 'ID de l''Ã©quipe gagnante, NULL si draw',
    match_data JSON COMMENT 'DonnÃ©es dÃ©taillÃ©es du match',
    server_name VARCHAR(100) COMMENT 'Serveur oÃ¹ s''est dÃ©roulÃ© le match',
    started_at TIMESTAMP NULL,
    ended_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_status (match_status),
    INDEX idx_arena (arena_name),
    INDEX idx_game_mode (game_mode),
    INDEX idx_started_at (started_at DESC),
    INDEX idx_duration (duration_seconds),
    CONSTRAINT fk_matches_arena 
        FOREIGN KEY (arena_name) REFERENCES arenas(name)
        ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Structure `match_data`** :
```json
{
    "teams": [
        {
            "team_id": 1,
            "team_name": "Red Team",
            "final_score": 3,
            "cells_captured": 5,
            "nexus_health": 0
        }
    ],
    "phases": [
        {
            "phase": "CAPTURE",
            "duration_seconds": 120,
            "events": []
        }
    ],
    "final_stats": {
        "total_kills": 25,
        "total_damage": 1250.5,
        "mvp_player": "uuid-here"
    }
}
```

### Table `match_participants`
[cite_start]Participation et statistiques individuelles par match. [cite: 753]

```sql
CREATE TABLE match_participants (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    match_id VARCHAR(36) NOT NULL,
    player_uuid CHAR(36) NOT NULL,
    team_id INT NOT NULL,
    
    -- Statistiques de combat
    kills INT DEFAULT 0,
    deaths INT DEFAULT 0,
    assists INT DEFAULT 0,
    damage_dealt DOUBLE DEFAULT 0.0,
    damage_received DOUBLE DEFAULT 0.0,
    best_killstreak INT DEFAULT 0,
    
    -- Statistiques d'objectif
    cells_captured INT DEFAULT 0,
    cells_delivered INT DEFAULT 0,
    nexus_damage_dealt INT DEFAULT 0,
    
    -- Ã‰conomie et progression
    points_earned INT DEFAULT 0,
    elo_before INT DEFAULT 0,
    elo_after INT DEFAULT 0,
    elo_change INT DEFAULT 0,
    
    -- MÃ©ta-donnÃ©es
    duration_seconds INT DEFAULT 0,
    left_early BOOLEAN DEFAULT FALSE,
    disconnect_reason VARCHAR(100),
    
    -- DÃ©tails de performance
    accuracy_percentage DECIMAL(5,2) COMMENT 'PrÃ©cision des attaques',
    items_purchased JSON COMMENT 'Items achetÃ©s pendant le match',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_match_participants_match 
        FOREIGN KEY (match_id) REFERENCES matches(id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_match_participants_player 
        FOREIGN KEY (player_uuid) REFERENCES player_profiles(player_uuid) 
        ON DELETE CASCADE,
    
    UNIQUE KEY unique_match_player (match_id, player_uuid),
    INDEX idx_player_matches (player_uuid, created_at DESC),
    INDEX idx_match_team (match_id, team_id),
    INDEX idx_performance (kills DESC, deaths ASC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### Table `economy_transactions`
[cite_start]Historique des transactions Ã©conomiques. [cite: 757]

```sql
CREATE TABLE economy_transactions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    player_uuid CHAR(36) NOT NULL,
    transaction_type ENUM(
        'EARN_KILL', 'EARN_ASSIST', 'EARN_VICTORY', 'EARN_PARTICIPATION',
        'EARN_STREAK', 'EARN_OBJECTIVE', 'EARN_MVP', 'EARN_SEASONAL',
        'SPEND_SHOP', 'SPEND_UPGRADE', 'SPEND_COSMETIC',
        'ADMIN_ADD', 'ADMIN_REMOVE', 'ADMIN_RESET',
        'TRANSFER_SEND', 'TRANSFER_RECEIVE'
    ) NOT NULL,
    amount INT NOT NULL COMMENT 'Positif pour gains, nÃ©gatif pour dÃ©penses',
    balance_before INT NOT NULL,
    balance_after INT NOT NULL,
    reason VARCHAR(255),
    related_match_id VARCHAR(36) COMMENT 'Match associÃ© si applicable',
    metadata JSON COMMENT 'DonnÃ©es supplÃ©mentaires de la transaction',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_economy_player 
        FOREIGN KEY (player_uuid) REFERENCES player_profiles(player_uuid) 
        ON DELETE CASCADE,
    CONSTRAINT fk_economy_match
        FOREIGN KEY (related_match_id) REFERENCES matches(id)
        ON DELETE SET NULL,
    
    INDEX idx_player_transactions (player_uuid, created_at DESC),
    INDEX idx_transaction_type (transaction_type),
    INDEX idx_amount (amount DESC),
    INDEX idx_date (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### Table `seasons`
[cite_start]Gestion des saisons compÃ©titives. [cite: 760]

```sql
CREATE TABLE seasons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    season_name VARCHAR(100) NOT NULL,
    season_number INT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    rewards_data JSON COMMENT 'Configuration des rÃ©compenses de saison',
    rules_data JSON COMMENT 'RÃ¨gles spÃ©cifiques de la saison',
    statistics JSON COMMENT 'Statistiques de la saison',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY unique_active_season (is_active, start_date),
    INDEX idx_season_number (season_number DESC),
    INDEX idx_dates (start_date, end_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Structure `rewards_data`** :
```json
{
    "rank_rewards": {
        "CHAMPION": {"cosmetics": ["golden_crown"], "points": 5000},
        "GRANDMASTER": {"cosmetics": ["silver_crown"], "points": 3000},
        "MASTER": {"cosmetics": ["bronze_crown"], "points": 2000}
    },
    "participation_rewards": {
        "min_matches": 10,
        "rewards": {"cosmetics": ["season_badge"], "points": 500}
    },
    "milestone_rewards": [
        {"matches_played": 50, "reward": {"points": 1000}},
        {"wins": 25, "reward": {"cosmetics": ["victory_banner"]}}
    ]
}
```

### Table `season_rewards`
[cite_start]RÃ©compenses distribuÃ©es par saison. [cite: 764]
```sql
CREATE TABLE season_rewards (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    season_id INT NOT NULL,
    player_uuid CHAR(36) NOT NULL,
    final_rank ENUM(
        'UNRANKED', 'BRONZE_I', 'BRONZE_II', 'BRONZE_III',
        'SILVER_I', 'SILVER_II', 'SILVER_III',
        'GOLD_I', 'GOLD_II', 'GOLD_III',
        'PLATINUM_I', 'PLATINUM_II', 'PLATINUM_III',
        'DIAMOND_I', 'DIAMOND_II', 'DIAMOND_III',
        'MASTER', 'GRANDMASTER', 'CHAMPION'
    ) NOT NULL,
    final_elo INT NOT NULL,
    matches_played INT NOT NULL,
    peak_elo INT COMMENT 'ELO le plus Ã©levÃ© atteint pendant la saison',
    rewards_claimed BOOLEAN DEFAULT FALSE,
    rewards_data JSON COMMENT 'RÃ©compenses accordÃ©es',
    claimed_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_season_rewards_season 
        FOREIGN KEY (season_id) REFERENCES seasons(id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_season_rewards_player 
        FOREIGN KEY (player_uuid) REFERENCES player_profiles(player_uuid) 
        ON DELETE CASCADE,
    
    UNIQUE KEY unique_season_player (season_id, player_uuid),
    INDEX idx_season_rank (season_id, final_rank),
    INDEX idx_unclaimed_rewards (rewards_claimed, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## ðŸ”§ Migrations Flyway

### V1__initial_schema.sql
```sql
-- Migration initiale avec les tables de base
CREATE TABLE arenas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    max_players INT NOT NULL,
    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
-- Schema de base pour le systÃ¨me d'arÃ¨nes
-- (Version simplifiÃ©e pour le dÃ©marrage)
```

### V2__create_arena_tables.sql
```sql
-- Extension du systÃ¨me d'arÃ¨nes avec spawns
CREATE TABLE arena_spawns (
    id INT AUTO_INCREMENT PRIMARY KEY,
    arena_id INT NOT NULL,
    team_id INT NOT NULL,
    spawn_number INT NOT NULL,
    world VARCHAR(255) NOT NULL,
    x DOUBLE NOT NULL,
    y DOUBLE NOT NULL,
    z DOUBLE NOT NULL,
    yaw FLOAT NOT NULL,
    pitch FLOAT NOT NULL,
    CONSTRAINT fk_arena
        FOREIGN KEY (arena_id) REFERENCES arenas(id)
        ON DELETE CASCADE,
    UNIQUE KEY unique_spawn (arena_id, team_id, spawn_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### V3__add_game_modes.sql
```sql
-- Ajout du support des modes de jeu
ALTER TABLE arenas 
ADD COLUMN game_mode ENUM(
    'SOLO_1V1', 'SOLO_1V1V1', 'SOLO_1V1V1V1',
    'TEAM_2V2', 'TEAM_3V3', 'TEAM_4V4', 'BATTLE_6V6V6V6'
[cite_start]) NOT NULL DEFAULT 'TEAM_2V2' AFTER name; [cite: 771]
ALTER TABLE arenas 
[cite_start]ADD COLUMN min_players INT NOT NULL DEFAULT 2 AFTER max_players; [cite: 772]
ALTER TABLE arenas 
[cite_start]ADD COLUMN world_name VARCHAR(255) NOT NULL DEFAULT 'world' AFTER min_players; [cite: 773]
```

### V4__create_player_system.sql
```sql
-- CrÃ©ation du systÃ¨me de joueurs complet
CREATE TABLE player_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    player_uuid CHAR(36) NOT NULL UNIQUE,
    player_name VARCHAR(16) NOT NULL,
    display_name VARCHAR(32),
    elo_rating INT DEFAULT 1000,
    current_rank ENUM(
        'UNRANKED', 'BRONZE_I', 'BRONZE_II', 'BRONZE_III',
        'SILVER_I', 'SILVER_II', 'SILVER_III',
        'GOLD_I', 'GOLD_II', 'GOLD_III',
        'PLATINUM_I', 'PLATINUM_II', 'PLATINUM_III',
        'DIAMOND_I', 'DIAMOND_II', 'DIAMOND_III',
        'MASTER', 'GRANDMASTER', 'CHAMPION'
    ) DEFAULT 'UNRANKED',
    total_points INT DEFAULT 0,
    settings_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
-- Index pour optimiser les requÃªtes
[cite_start]CREATE INDEX idx_elo_rating ON player_profiles(elo_rating DESC); [cite: 775]
[cite_start]CREATE INDEX idx_rank ON player_profiles(current_rank); [cite: 775]
[cite_start]CREATE INDEX idx_points ON player_profiles(total_points DESC); [cite: 776]
```

### V5__create_match_system.sql
```sql
-- SystÃ¨me de matches et statistiques
CREATE TABLE matches (
    id VARCHAR(36) PRIMARY KEY,
    arena_name VARCHAR(255) NOT NULL,
    game_mode ENUM(
        'SOLO_1V1', 'SOLO_1V1V1', 'SOLO_1V1V1V1',
        'TEAM_2V2', 'TEAM_3V3', 'TEAM_4V4', 'BATTLE_6V6V6V6'
    ) NOT NULL,
    match_status ENUM('WAITING', 'STARTING', 'IN_PROGRESS', 'FINISHED', 'CANCELLED') NOT NULL,
    total_players INT NOT NULL,
    duration_seconds INT DEFAULT 0,
    winner_team_id INT,
    match_data JSON,
    started_at TIMESTAMP NULL,
    ended_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
[cite_start]) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; [cite: 777]
CREATE TABLE match_participants (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    match_id VARCHAR(36) NOT NULL,
    player_uuid CHAR(36) NOT NULL,
    team_id INT NOT NULL,
    kills INT DEFAULT 0,
    deaths INT DEFAULT 0,
    assists INT DEFAULT 0,
    damage_dealt DOUBLE DEFAULT 0.0,
    damage_received DOUBLE DEFAULT 0.0,
    points_earned INT DEFAULT 0,
    elo_change INT DEFAULT 0,
    left_early BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE,
    FOREIGN KEY (player_uuid) REFERENCES player_profiles(player_uuid) ON DELETE CASCADE
[cite_start]) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; [cite: 779]
```

## ðŸ“Š RequÃªtes d'Exemple

### Classement Global
```sql
-- Top 10 des joueurs par ELO
SELECT 
    player_name,
    display_name,
    current_rank,
    elo_rating,
    total_points
FROM player_profiles 
WHERE is_active = TRUE
ORDER BY elo_rating DESC 
LIMIT 10;
```

### Statistiques de Joueur
```sql
-- Statistiques complÃ¨tes d'un joueur
SELECT 
    pp.player_name,
    pp.elo_rating,
    pp.current_rank,
    ps.total_matches,
    ps.wins,
    ps.losses,
    ROUND(ps.wins / GREATEST(ps.total_matches, 1) * 100, 2) as win_rate,
    ps.kills,
    ps.deaths,
    ROUND(ps.kills / GREATEST(ps.deaths, 1), 2) as kdr,
    ps.cells_delivered,
    ps.nexus_destroyed
FROM player_profiles pp
JOIN player_statistics ps ON pp.player_uuid = ps.player_uuid
WHERE pp.player_uuid = ?
[cite_start]AND ps.game_mode = 'TEAM_2V2'; [cite: 782]
```

### Historique des Matches
```sql
-- Derniers matches d'un joueur
SELECT 
    m.id,
    m.arena_name,
    m.game_mode,
    m.duration_seconds,
    m.winner_team_id,
    mp.team_id,
    mp.kills,
    mp.deaths,
    mp.assists,
    mp.points_earned,
    mp.elo_change,
    m.started_at
FROM matches m
JOIN match_participants mp ON m.id = mp.match_id
WHERE mp.player_uuid = ?
ORDER BY m.started_at DESC
[cite_start]LIMIT 20; [cite: 783]
```

### Performance d'ArÃ¨ne
```sql
-- Statistiques d'utilisation des arÃ¨nes
SELECT 
    a.name,
    a.game_mode,
    COUNT(m.id) as total_matches,
    AVG(m.duration_seconds) as avg_duration,
    COUNT(DISTINCT mp.player_uuid) as unique_players
FROM arenas a
LEFT JOIN matches m ON a.name = m.arena_name
LEFT JOIN match_participants mp ON m.id = mp.match_id
WHERE m.match_status = 'FINISHED'
GROUP BY a.id, a.name, a.game_mode
ORDER BY total_matches DESC;
```

## ðŸ”§ Configuration HikariCP

### ParamÃ¨tres OptimisÃ©s pour Production
```java
public class DatabaseConfig {
    
    private static HikariConfig createConfig() {
        HikariConfig config = new HikariConfig();
        // Connexion de base
        config.setJdbcUrl("jdbc:mariadb://localhost:3306/nexus");
        config.setUsername("nexus_user");
        config.setPassword("strong_password_here");
        // Pool settings
        config.setMaximumPoolSize(15);
        // Max connexions
        config.setMinimumIdle(5);
        // Connexions toujours prÃªtes
        config.setConnectionTimeout(20000);
        // 20s timeout
        config.setIdleTimeout(600000);
        // 10min idle
        config.setMaxLifetime(1800000);
        // 30min max life
        config.setLeakDetectionThreshold(60000);
        // 1min leak detection
        
        // Optimisations MariaDB
        config.addDataSourceProperty("useServerPrepStmts", "true");
        config.addDataSourceProperty("prepStmtCacheSize", "250");
        config.addDataSourceProperty("prepStmtCacheSqlLimit", "2048");
        config.addDataSourceProperty("useUnicode", "true");
        config.addDataSourceProperty("characterEncoding", "utf8mb4");
        config.addDataSourceProperty("serverTimezone", "UTC");
        config.addDataSourceProperty("rewriteBatchedStatements", "true");
        // Pool naming
        config.setPoolName("NexusHikariPool");
        
        return config;
    }
}
```

## ðŸš€ Performance et Optimisation

### Index RecommandÃ©s
```sql
-- Index composites pour requÃªtes frÃ©quentes
CREATE INDEX idx_player_stats_composite ON player_statistics(player_uuid, game_mode, wins DESC);
[cite_start]CREATE INDEX idx_match_participants_performance ON match_participants(player_uuid, kills DESC, deaths ASC); [cite: 796]
CREATE INDEX idx_transactions_recent ON economy_transactions(player_uuid, created_at DESC);
[cite_start]CREATE INDEX idx_matches_recent_by_arena ON matches(arena_name, started_at DESC); [cite: 797]

-- Index pour les classements
CREATE INDEX idx_leaderboard_global ON player_profiles(elo_rating DESC, is_active);
[cite_start]CREATE INDEX idx_leaderboard_by_rank ON player_profiles(current_rank, elo_rating DESC); [cite: 798]
```

### Partitioning Strategy (Pour Grande Ã‰chelle)
```sql
-- Partitioning de la table des matches par mois
ALTER TABLE matches PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
    PARTITION p202501 VALUES LESS THAN (202502),
    PARTITION p202502 VALUES LESS THAN (202503),
    PARTITION p202503 VALUES LESS THAN (202504),
    -- etc...
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
-- Partitioning des transactions par mois
ALTER TABLE economy_transactions PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
    PARTITION p202501 VALUES LESS THAN (202502),
    PARTITION p202502 VALUES LESS THAN (202503),
    -- etc...
);
```

### Maintenance et Nettoyage
```sql
-- ProcÃ©dure de nettoyage mensuel
DELIMITER //
CREATE PROCEDURE CleanupOldData()
BEGIN
    -- Supprimer les matches anciens (> 6 mois)
    DELETE FROM matches 
    WHERE created_at < DATE_SUB(NOW(), INTERVAL 6 MONTH)
    AND match_status IN ('FINISHED', 'CANCELLED');
    -- Supprimer les transactions anciennes (> 1 an)
    DELETE FROM economy_transactions 
    WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);
    -- Marquer comme inactifs les joueurs non vus depuis 3 mois
    UPDATE player_profiles 
    SET is_active = FALSE 
    WHERE last_seen < DATE_SUB(NOW(), INTERVAL 3 MONTH);
END //
DELIMITER ;

-- Planifier le nettoyage (Ã  exÃ©cuter via cron)
-- 0 2 1 * * /usr/bin/mysql -u nexus_user -p nexus -e "CALL CleanupOldData();"
```

Ce schÃ©ma de base de donnÃ©es est conÃ§u pour supporter des milliers de joueurs et des dizaines de milliers de matches, tout en maintenant des performances optimales grÃ¢ce aux index appropriÃ©s et aux stratÃ©gies de partitioning.
